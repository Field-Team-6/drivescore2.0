<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drive Score ‚Äî Field Team 6</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&family=Open+Sans:wght@400;500;600&family=Raleway:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --blue-dark: #1a2744;
            --blue-mid: #2b4c7e;
            --blue-bright: #3a7bd5;
            --blue-light: #5b9ef0;
            --blue-pale: #e8f0fe;
            --accent-gold: #f5c542;
            --white: #ffffff;
            --gray-50: #f8f9fa;
            --gray-100: #f0f2f5;
            --gray-200: #dde1e7;
            --gray-400: #9ca3af;
            --gray-600: #6b7280;
            --gray-800: #374151;
            --red-soft: #e74c3c;
            --green-success: #27ae60;
            --orange-warn: #e67e22;
            --shadow-sm: 0 1px 3px rgba(26, 39, 68, 0.12);
            --shadow-md: 0 4px 12px rgba(26, 39, 68, 0.15);
            --shadow-lg: 0 8px 30px rgba(26, 39, 68, 0.18);
            --radius: 10px;
        }

        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Raleway', 'Open Sans', sans-serif;
            background: linear-gradient(135deg, var(--blue-dark) 0%, var(--blue-mid) 50%, #1e3a5f 100%);
            min-height: 100vh;
            color: var(--gray-800);
            line-height: 1.6;
        }

        /* ===== HEADER ===== */
        .header {
            background: rgba(26, 39, 68, 0.95);
            backdrop-filter: blur(10px);
            padding: 24px 24px 20px;
            text-align: center;
            border-bottom: 3px solid var(--accent-gold);
            z-index: 100;
        }
        .header-top {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            margin-bottom: 10px;
        }
        .header-logo { height: 95px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)); }
        .header h1 {
            font-family: 'Typewriter Serial ExtraBold', 'American Typewriter', 'Courier New Bold', 'Monaco Bold', 'Andale Mono', 'Lucida Console', monospace;
            font-weight: 900;
            font-size: clamp(2.4rem, 8vw, 6.72rem);
            color: #ffffff;
            letter-spacing: normal;
            text-shadow: 4px 4px 8px rgba(0, 0, 0, 0.5);
            line-height: 0.85;
        }
        .header .tagline {
            color: var(--blue-light);
            font-size: 1rem;
            font-weight: 500;
            line-height: 1.6;
        }
        .header .tagline-italic {
            color: var(--blue-light);
            font-size: 1rem;
            font-style: italic;
            font-weight: 500;
            margin-top: 2px;
        }

        /* ===== CONTAINER ===== */
        .container { max-width: 600px; margin: 0 auto; padding: 20px 16px 40px; }

        /* ===== CARDS ===== */
        .card {
            background: var(--white);
            border-radius: var(--radius);
            padding: 28px 24px;
            margin-bottom: 16px;
            box-shadow: var(--shadow-lg);
            overflow: hidden;
        }
        .card-title {
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            font-size: 1.15rem;
            color: var(--blue-dark);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .card-title .icon { font-size: 1.3rem; }

        /* ===== FORM FIELDS ===== */
        .field { margin-bottom: 16px; }
        .field label {
            display: block;
            font-weight: 600;
            font-size: 0.88rem;
            color: var(--gray-800);
            margin-bottom: 5px;
        }
        .field input, .field select, .field textarea {
            width: 100%;
            max-width: 100%;
            padding: 11px 14px;
            border: 2px solid var(--gray-200);
            border-radius: 8px;
            font-size: 1rem;
            font-family: 'Raleway', 'Open Sans', sans-serif;
            color: var(--gray-800);
            background: var(--gray-50);
            transition: border-color 0.2s, box-shadow 0.2s;
            -webkit-appearance: none;
            appearance: none;
        }
        .field input:focus, .field select:focus, .field textarea:focus {
            outline: none;
            border-color: var(--blue-bright);
            box-shadow: 0 0 0 3px rgba(58, 123, 213, 0.15);
            background: var(--white);
        }
        .field-hint {
            font-size: 0.78rem;
            color: var(--gray-600);
            margin-top: 3px;
            font-style: italic;
        }
        .req { color: var(--red-soft); font-weight: 700; }

        /* ===== GRID ROWS ===== */
        .row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .row-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; }
        .row-4 { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 12px; }
        .row > *, .row-3 > *, .row-4 > * { min-width: 0; }

        /* ===== BUTTONS ===== */
        .btn {
            display: block;
            width: 100%;
            padding: 15px 24px;
            border: none;
            border-radius: var(--radius);
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            font-size: 1.05rem;
            cursor: pointer;
            transition: all 0.25s;
            letter-spacing: 0.3px;
        }
        .btn-continue {
            background: linear-gradient(135deg, var(--blue-bright), var(--blue-mid));
            color: var(--white);
            margin-top: 8px;
        }
        .btn-continue:hover { transform: translateY(-2px); box-shadow: var(--shadow-md); }

        .btn-scan {
            background: linear-gradient(135deg, var(--accent-gold), #e6b530);
            color: var(--blue-dark);
            font-size: 1.1rem;
            padding: 18px 24px;
        }
        .btn-scan:hover { transform: translateY(-2px); box-shadow: var(--shadow-md); }

        .btn-submit {
            background: linear-gradient(135deg, var(--green-success), #219a52);
            color: var(--white);
            margin-top: 8px;
        }
        .btn-submit:hover { transform: translateY(-2px); box-shadow: var(--shadow-md); }

        .btn-next {
            background: linear-gradient(135deg, var(--blue-bright), var(--blue-mid));
            color: var(--white);
            margin-top: 8px;
        }
        .btn-next:hover { transform: translateY(-2px); box-shadow: var(--shadow-md); }

        .btn-done {
            background: transparent;
            border: 2px solid rgba(255,255,255,0.4);
            color: rgba(255,255,255,0.9);
            margin-top: 10px;
            font-size: 0.95rem;
        }
        .btn-done:hover { border-color: rgba(255,255,255,0.7); background: rgba(255,255,255,0.05); }

        .btn-rescan {
            display: block;
            width: 100%;
            margin-top: 16px;
            padding: 10px;
            background: none;
            border: none;
            color: rgba(255,255,255,0.5);
            font-size: 0.85rem;
            cursor: pointer;
            text-align: center;
        }
        .btn-rescan:hover { color: rgba(255,255,255,0.8); }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* ===== DRIVE SUMMARY BAR ===== */
        .drive-summary {
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: var(--radius);
            padding: 14px 18px;
            margin-bottom: 16px;
            color: rgba(255,255,255,0.85);
            font-size: 0.88rem;
            position: relative;
        }
        .summary-label {
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--accent-gold);
            margin-bottom: 4px;
        }
        .edit-link {
            position: absolute;
            top: 14px;
            right: 18px;
            font-size: 0.82rem;
            color: var(--accent-gold);
            cursor: pointer;
            text-decoration: none;
        }
        .edit-link:hover { text-decoration: underline; }

        /* ===== START SCAN AREA ===== */
        .scan-area {
            border: 3px dashed var(--gray-200);
            border-radius: var(--radius);
            padding: 40px 20px;
            text-align: center;
            margin-bottom: 20px;
            transition: border-color 0.3s, background 0.3s;
            cursor: pointer;
        }
        .scan-area:hover {
            border-color: var(--blue-bright);
            background: rgba(58, 123, 213, 0.03);
        }
        .scan-icon { font-size: 3rem; margin-bottom: 12px; }
        .scan-text {
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            font-size: 1.05rem;
            color: var(--gray-800);
            margin-bottom: 4px;
        }
        .scan-hint { font-size: 0.85rem; color: var(--gray-600); font-weight: 600; }
        .scan-privacy { font-size: 0.85rem; color: var(--gray-600); margin-top: 8px; font-style: italic; font-weight: 600; }

        /* ===== PROCESSING OVERLAY ===== */
        .processing-overlay {
            display: none;
            text-align: center;
            padding: 40px 20px;
        }
        .processing-overlay.active { display: block; }
        .spinner {
            width: 48px; height: 48px;
            border: 4px solid var(--gray-200);
            border-top-color: var(--blue-bright);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 16px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .processing-text {
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            color: var(--blue-bright);
            font-size: 1rem;
        }
        .processing-subtext {
            color: var(--gray-600);
            font-size: 0.85rem;
            margin-top: 4px;
        }

        /* ===== VOTER COUNTER ===== */
        .voter-counter {
            text-align: center;
            padding: 12px;
            background: rgba(245, 197, 66, 0.1);
            border: 1px solid rgba(245, 197, 66, 0.3);
            border-radius: var(--radius);
            margin-bottom: 16px;
        }
        .voter-counter .count {
            font-family: 'Montserrat', sans-serif;
            font-weight: 800;
            font-size: 2rem;
            color: var(--accent-gold);
        }
        .voter-counter .count-label {
            font-size: 0.85rem;
            color: rgba(255,255,255,0.7);
            font-weight: 500;
        }

        /* ===== CONFIDENCE INDICATOR ===== */
        .confidence-bar {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 20px;
            padding: 10px 14px;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        .confidence-high {
            background: rgba(39, 174, 96, 0.1);
            color: var(--green-success);
            border: 1px solid rgba(39, 174, 96, 0.2);
        }
        .confidence-medium {
            background: rgba(230, 126, 34, 0.1);
            color: var(--orange-warn);
            border: 1px solid rgba(230, 126, 34, 0.2);
        }
        .confidence-low {
            background: rgba(231, 76, 60, 0.1);
            color: var(--red-soft);
            border: 1px solid rgba(231, 76, 60, 0.2);
        }

        /* ===== STATUS ===== */
        .status {
            text-align: center; padding: 16px; border-radius: var(--radius);
            font-weight: 600; margin-top: 16px; display: none;
        }
        .status.success { display: block; background: rgba(39, 174, 96, 0.1); color: var(--green-success); border: 2px solid rgba(39, 174, 96, 0.3); }
        .status.error { display: block; background: rgba(231, 76, 60, 0.1); color: var(--red-soft); border: 2px solid rgba(231, 76, 60, 0.3); }
        .status.sending { display: block; background: rgba(58, 123, 213, 0.1); color: var(--blue-bright); border: 2px solid rgba(58, 123, 213, 0.3); }

        /* ===== HIDDEN ===== */
        .hidden { display: none !important; }

        /* ===== FAQ ===== */
        .faq-btn-wrapper { text-align: center; margin: 30px 0 20px; }
        .faq-toggle-btn {
            background: #03013c; color: white; padding: 12px 25px; border: none;
            border-radius: 8px; font-size: 1rem; cursor: pointer; font-weight: bold;
            font-family: 'Raleway', sans-serif; transition: all 0.3s ease;
        }
        .faq-toggle-btn:hover { background: #1a1a5e; transform: translateY(-2px); }
        .faq-container {
            display: none; background: white; border-radius: 15px;
            padding: 30px; margin: 20px auto; max-width: 720px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .faq-container.show { display: block; }
        .faq-header { text-align: center; margin-bottom: 30px; }
        .faq-header h2 { color: #333; font-size: 2rem; margin-bottom: 10px; font-family: 'Montserrat', sans-serif; }
        .faq-close {
            background: var(--blue-bright); color: white; border: none;
            padding: 10px 20px; border-radius: 8px; cursor: pointer;
            font-weight: bold; font-family: 'Raleway', sans-serif; transition: all 0.3s ease;
        }
        .faq-close:hover { background: var(--blue-mid); transform: translateY(-2px); }
        .faq-item { margin-bottom: 25px; border-bottom: 1px solid #e1e5e9; padding-bottom: 20px; }
        .faq-item:last-child { border-bottom: none; }
        .faq-question { font-weight: bold; color: #333; font-size: 1.1rem; margin-bottom: 10px; }
        .faq-answer { color: #666; line-height: 1.6; font-size: 0.95rem; }
        .faq-answer a { color: var(--blue-bright); text-decoration: none; font-weight: 600; }
        .faq-answer a:hover { text-decoration: underline; }

        /* ===== CONFETTI ===== */
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
            overflow: hidden;
        }
        .confetti-piece {
            position: absolute;
            top: -20px;
            width: 10px;
            height: 16px;
            border-radius: 2px;
            animation: confetti-fall linear forwards;
        }
        @keyframes confetti-fall {
            0% { transform: translateY(0) rotate(0deg) scale(1); opacity: 1; }
            75% { opacity: 1; }
            100% { transform: translateY(105vh) rotate(720deg) scale(0.6); opacity: 0; }
        }

        /* ===== FOOTER ===== */
        .footer { text-align: center; padding: 20px; color: rgba(255,255,255,0.5); font-size: 0.78rem; line-height: 1.7; }
        .footer a { color: rgba(255,255,255,0.7); text-decoration: none; }

        /* ===== PHOTO UPLOAD STEP ===== */
        .photo-section {
            margin-bottom: 24px;
        }
        .photo-section-title {
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            font-size: 1.05rem;
            color: var(--blue-dark);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .photo-section-hint {
            font-size: 0.85rem;
            color: var(--gray-600);
            margin-bottom: 12px;
            font-style: italic;
        }
        .photo-btn-row {
            display: flex;
            gap: 10px;
            margin-bottom: 14px;
        }
        .photo-btn-row .btn-photo {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 14px 12px;
            border: 2px dashed var(--gray-200);
            border-radius: 8px;
            background: var(--gray-50);
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            font-size: 0.88rem;
            color: var(--blue-mid);
            cursor: pointer;
            transition: all 0.2s;
        }
        .photo-btn-row .btn-photo:hover {
            border-color: var(--blue-bright);
            background: rgba(58, 123, 213, 0.05);
        }
        .photo-btn-row .btn-photo .photo-btn-icon {
            font-size: 1.3rem;
        }
        .photo-thumbs {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .photo-thumb-wrapper {
            position: relative;
            width: 80px;
            height: 80px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            border: 2px solid var(--gray-200);
        }
        .photo-thumb-wrapper img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .photo-thumb-remove {
            position: absolute;
            top: 2px;
            right: 2px;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: rgba(231, 76, 60, 0.9);
            color: white;
            border: none;
            font-size: 14px;
            line-height: 22px;
            text-align: center;
            cursor: pointer;
            padding: 0;
        }
        .photo-thumb-remove:hover { background: var(--red-soft); }
        .photo-count {
            font-size: 0.82rem;
            color: var(--gray-600);
            margin-top: 6px;
            font-weight: 600;
        }
        .photo-divider {
            border: none;
            border-top: 1px solid var(--gray-200);
            margin: 20px 0;
        }
        .btn-send-photos {
            background: linear-gradient(135deg, var(--blue-bright), var(--blue-mid));
            color: var(--white);
        }
        .btn-send-photos:hover { transform: translateY(-2px); box-shadow: var(--shadow-md); }
        .btn-skip-photos {
            background: transparent;
            border: 2px solid var(--gray-200);
            color: var(--gray-600);
            margin-top: 8px;
            font-size: 0.95rem;
        }
        .btn-skip-photos:hover { border-color: var(--gray-400); color: var(--gray-800); }
        .upload-progress {
            margin-top: 16px;
            text-align: center;
            display: none;
        }
        .upload-progress.active { display: block; }
        .upload-progress-bar-bg {
            width: 100%;
            height: 8px;
            background: var(--gray-200);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 8px;
        }
        .upload-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--blue-bright), var(--blue-light));
            border-radius: 4px;
            transition: width 0.3s;
            width: 0%;
        }
        .upload-progress-text {
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            font-size: 0.88rem;
            color: var(--blue-bright);
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 600px) {
            .card { padding: 20px 18px; }
            .row, .row-3 { grid-template-columns: 1fr; }
            .row-4 { grid-template-columns: 1fr 1fr; }
            .header-top { gap: 12px; }
            .header-logo { height: 72px; }
            .faq-container { margin: 10px; padding: 20px; }
            .faq-header h2 { font-size: 1.5rem; }
        }
    </style>
</head>
<body>

<!-- ===== HEADER ===== -->
<div class="header">
    <div class="header-top">
        <img src="https://drive-scout.netlify.app/images/FT6Logo2.png" alt="Field Team 6 Logo" class="header-logo">
        <h1>Drive Score</h1>
    </div>
    <div class="tagline">Report your results. Every voter counts!</div>
    <div class="tagline-italic">Because in this game, the high score is saving our democracy.</div>
</div>

<!-- ===== MAIN ===== -->
<div class="container">

    <!-- ========================================== -->
    <!-- STEP 1: DRIVE INFO                         -->
    <!-- ========================================== -->
    <div id="step1">
        <div class="card">
            <div class="card-title"><span class="icon">üìã</span> Drive Information</div>

            <div class="row">
                <div class="field">
                    <label for="leaderFirst">Drive Leader First Name <span class="req">*</span></label>
                    <input type="text" id="leaderFirst" placeholder="e.g. Jane" required>
                </div>
                <div class="field">
                    <label for="leaderLast">Drive Leader Last Name <span class="req">*</span></label>
                    <input type="text" id="leaderLast" placeholder="e.g. Smith" required>
                </div>
            </div>

            <div class="row">
                <div class="field">
                    <label for="driveDate">Date of Drive <span class="req">*</span></label>
                    <input type="date" id="driveDate" required>
                </div>
                <div class="field">
                    <label for="driveTime">Time of Drive <span class="req">*</span></label>
                    <input type="time" id="driveTime" required>
                </div>
            </div>

            <div class="row">
                <div class="field">
                    <label for="driveCity">City <span class="req">*</span></label>
                    <input type="text" id="driveCity" placeholder="e.g. Phoenix" required>
                </div>
                <div class="field">
                    <label for="driveState">State <span class="req">*</span></label>
                    <select id="driveState" required>
                        <option value="">Select state‚Ä¶</option>
                        <option>Alabama</option><option>Alaska</option><option>Arizona</option><option>Arkansas</option>
                        <option>California</option><option>Colorado</option><option>Connecticut</option><option>Delaware</option>
                        <option>Florida</option><option>Georgia</option><option>Hawaii</option><option>Idaho</option>
                        <option>Illinois</option><option>Indiana</option><option>Iowa</option><option>Kansas</option>
                        <option>Kentucky</option><option>Louisiana</option><option>Maine</option><option>Maryland</option>
                        <option>Massachusetts</option><option>Michigan</option><option>Minnesota</option><option>Mississippi</option>
                        <option>Missouri</option><option>Montana</option><option>Nebraska</option><option>Nevada</option>
                        <option>New Hampshire</option><option>New Jersey</option><option>New Mexico</option><option>New York</option>
                        <option>North Carolina</option><option>North Dakota</option><option>Ohio</option><option>Oklahoma</option>
                        <option>Oregon</option><option>Pennsylvania</option><option>Rhode Island</option><option>South Carolina</option>
                        <option>South Dakota</option><option>Tennessee</option><option>Texas</option><option>Utah</option>
                        <option>Vermont</option><option>Virginia</option><option>Washington</option><option>West Virginia</option>
                        <option>Wisconsin</option><option>Wyoming</option><option>Washington D.C.</option>
                    </select>
                </div>
            </div>

            <button type="button" class="btn btn-continue" onclick="continueToScan()">
                Continue to Form Scanning ‚Üí
            </button>
            <div id="step1Error" class="status" style="display:none;"></div>
        </div>
    </div>

    <!-- ========================================== -->
    <!-- STEP 2: SCAN FORM                          -->
    <!-- ========================================== -->
    <div id="step2" class="hidden">

        <div class="drive-summary" id="driveSummary">
            <div class="summary-label">Drive Info</div>
            <div class="summary-details" id="summaryText"></div>
            <span class="edit-link" onclick="editDriveInfo()">‚úèÔ∏è Edit</span>
        </div>

        <div class="voter-counter" id="voterCounter">
            <div class="count" id="voterCountNum">0</div>
            <div class="count-label">voters submitted so far</div>
        </div>

        <div class="card">
            <div class="card-title"><span class="icon">üìã</span> Scan Voter Registration Form</div>

            <!-- Scan button triggers native camera -->
            <div id="scanArea" class="scan-area" onclick="document.getElementById('scanFile').click()">
                <div class="scan-icon"><img src="data:image/png;base64,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" alt="phone" style="height: 84px; width: auto;"></div>
                <div class="scan-text">Tap to scan form</div>
                <div id="scanHint" class="scan-hint"><span style="color: var(--red-soft); font-weight: 800;">IMPORTANT:</span> Turn the phone horizontal (landscape) and get as close to the form as you can, while keeping name, address and date of birth visible.</div>
                <div class="scan-privacy">The scan is only used to read the text. The image is never saved or stored.</div>
            </div>

            <!-- Hidden file input with native camera capture -->
            <input type="file" id="scanFile" accept="image/*" capture="environment" onchange="handleScanCapture(event)" style="display:none;">


            <!-- Processing overlay -->
            <div class="processing-overlay" id="processingOverlay">
                <div class="spinner"></div>
                <div class="processing-text">Reading the form‚Ä¶</div>
                <div class="processing-subtext">This usually takes a few seconds</div>
            </div>

            <div id="scanError" class="status" style="display:none;"></div>
        </div>

        <button type="button" class="btn btn-done" onclick="finishDrive()">
            ‚úÖ Done ‚Äî Finish Drive Report
        </button>
    </div>

    <!-- ========================================== -->
    <!-- STEP 3: REVIEW & EDIT                      -->
    <!-- ========================================== -->
    <div id="step3" class="hidden">

        <div class="drive-summary">
            <div class="summary-label">Drive Info</div>
            <div class="summary-details" id="summaryText2"></div>
        </div>

        <div class="card">
            <div class="card-title"><span class="icon">‚úèÔ∏è</span> Review Voter #<span id="reviewVoterNum">1</span></div>

            <div id="confidenceIndicator" class="confidence-bar confidence-high">
                <span id="confidenceIcon">‚úÖ</span>
                <span id="confidenceText">High confidence ‚Äì <span style="color: var(--red-soft); font-weight: 700;">but always check all fields to correct errors</span></span>
            </div>

            <div class="row-4">
                <div class="field">
                    <label for="vFirstName">First Name <span class="req">*</span></label>
                    <input type="text" id="vFirstName" placeholder="First" required>
                </div>
                <div class="field">
                    <label for="vMiddleName">Middle Name</label>
                    <input type="text" id="vMiddleName" placeholder="Middle">
                </div>
                <div class="field">
                    <label for="vLastName">Last Name <span class="req">*</span></label>
                    <input type="text" id="vLastName" placeholder="Last" required>
                </div>
                <div class="field">
                    <label for="vSuffix">Suffix</label>
                    <input type="text" id="vSuffix" placeholder="Jr., II">
                </div>
            </div>

            <div class="field">
                <label for="vStreet">Street Address <span class="req">*</span></label>
                <input type="text" id="vStreet" placeholder="e.g. 123 Main Street" required>
            </div>

            <div class="field">
                <label for="vApt">Apt #/Unit #</label>
                <input type="text" id="vApt" placeholder="e.g. Apt 4B">
            </div>

            <div class="row-3">
                <div class="field">
                    <label for="vCity">City <span class="req">*</span></label>
                    <input type="text" id="vCity" required>
                </div>
                <div class="field">
                    <label for="vState">State <span class="req">*</span></label>
                    <input type="text" id="vState" readonly tabindex="-1" autocomplete="off">
                </div>
                <div class="field">
                    <label for="vZip">ZIP Code <span class="req">*</span></label>
                    <input type="text" id="vZip" placeholder="e.g. 85001" required>
                </div>
            </div>

            <!-- DOB field ‚Äî dynamically shown/hidden based on state -->
            <div id="dobField">
                <label>Date of Birth <span class="req">*</span></label>
                <div class="row-3">
                    <div class="field">
                        <select id="vDOBMonth">
                            <option value="">Month</option>
                            <option value="01">January</option>
                            <option value="02">February</option>
                            <option value="03">March</option>
                            <option value="04">April</option>
                            <option value="05">May</option>
                            <option value="06">June</option>
                            <option value="07">July</option>
                            <option value="08">August</option>
                            <option value="09">September</option>
                            <option value="10">October</option>
                            <option value="11">November</option>
                            <option value="12">December</option>
                        </select>
                    </div>
                    <div class="field">
                        <select id="vDOBDay">
                            <option value="">Day</option>
                        </select>
                    </div>
                    <div class="field">
                        <select id="vDOBYear">
                            <option value="">Year</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Georgia / Colorado: Year of Birth only -->
            <div id="yobField" class="field hidden">
                <label for="vYOB">Year of Birth <span class="req">*</span></label>
                <input type="text" id="vYOB" placeholder="e.g. 2004">
                <div class="field-hint">Georgia and Colorado require year of birth only</div>
            </div>
        </div>

        <div id="reviewError" class="status" style="display:none;"></div>

        <button type="button" class="btn btn-submit" id="submitVoterBtn" onclick="submitVoterAndNext()">
            ‚úÖ Submit & Scan Next Form
        </button>

        <button type="button" class="btn btn-done" onclick="submitVoterAndFinish()" style="margin-top:8px;">
            ‚úÖ Submit & Finish (Last Form)
        </button>

        <button type="button" class="btn-rescan" onclick="rescanForm()">
            üîÑ Scan this form again
        </button>
    </div>

    <!-- ========================================== -->
    <!-- STEP 4: PHOTO UPLOAD                      -->
    <!-- ========================================== -->
    <div id="step4" class="hidden">
        <div class="card">
            <div class="card-title" style="justify-content: center; font-size: 1.15rem;">
                <span class="icon">üì∏</span> Share Photos from Your Drive
            </div>
            <p style="color: var(--gray-600); text-align: center; margin-bottom: 24px; font-size: 0.92rem;">
                Do you have any photos from today's drive or volunteer sign-up sheets? Adding these helps Field Team 6 celebrate and track your amazing work!
            </p>

            <!-- Drive Photos Section -->
            <div class="photo-section">
                <div class="photo-section-title">üì∏ Voter Drive Photos</div>
                <div class="photo-section-hint">Photos of volunteers, the event, your table setup, etc.</div>
                <div class="photo-btn-row">
                    <label class="btn-photo" onclick="document.getElementById('drivePhotoCam').click()">
                        <span class="photo-btn-icon">üì∑</span> Take Photo
                    </label>
                    <label class="btn-photo" onclick="document.getElementById('drivePhotoLib').click()">
                        <span class="photo-btn-icon">üñºÔ∏è</span> Choose from Library
                    </label>
                </div>
                <input type="file" id="drivePhotoCam" accept="image/*" capture="environment" multiple style="display:none;" onchange="handlePhotoSelect(event, 'drive')">
                <input type="file" id="drivePhotoLib" accept="image/*" multiple style="display:none;" onchange="handlePhotoSelect(event, 'drive')">
                <div class="photo-thumbs" id="drivePhotoThumbs"></div>
                <div class="photo-count" id="drivePhotoCount"></div>
            </div>

            <hr class="photo-divider">

            <!-- Signup Sheet Photos Section -->
            <div class="photo-section">
                <div class="photo-section-title">üìã Volunteer Sign-Up Sheets</div>
                <div class="photo-section-hint">Photos of any sign-up sheets from today's drive.</div>
                <div class="photo-btn-row">
                    <label class="btn-photo" onclick="document.getElementById('signupPhotoCam').click()">
                        <span class="photo-btn-icon">üì∑</span> Take Photo
                    </label>
                    <label class="btn-photo" onclick="document.getElementById('signupPhotoLib').click()">
                        <span class="photo-btn-icon">üñºÔ∏è</span> Choose from Library
                    </label>
                </div>
                <input type="file" id="signupPhotoCam" accept="image/*" capture="environment" multiple style="display:none;" onchange="handlePhotoSelect(event, 'signup')">
                <input type="file" id="signupPhotoLib" accept="image/*" multiple style="display:none;" onchange="handlePhotoSelect(event, 'signup')">
                <div class="photo-thumbs" id="signupPhotoThumbs"></div>
                <div class="photo-count" id="signupPhotoCount"></div>
            </div>
        </div>

        <button type="button" class="btn btn-send-photos" id="sendPhotosBtn" onclick="sendPhotos()">
            üì§ Send to Field Team 6
        </button>

        <button type="button" class="btn btn-skip-photos" onclick="skipPhotos()">
            Skip ‚Äî No Photos This Time
        </button>

        <div class="upload-progress" id="uploadProgress">
            <div class="upload-progress-bar-bg">
                <div class="upload-progress-bar" id="uploadProgressBar"></div>
            </div>
            <div class="upload-progress-text" id="uploadProgressText">Uploading...</div>
        </div>

        <div id="photoUploadError" class="status" style="display:none;"></div>
    </div>

    <!-- ========================================== -->
    <!-- STEP 5: COMPLETE                           -->
    <!-- ========================================== -->
    <div id="step5" class="hidden">
        <div class="card" style="text-align:center; padding: 40px 24px;">
            <div style="font-size: 3rem; margin-bottom: 16px;">üéâ</div>
            <div class="card-title" style="justify-content: center; font-size: 1.3rem; margin-bottom: 12px;">Drive Report Complete!</div>
            <p style="color: var(--gray-600); margin-bottom: 8px;">
                You submitted <strong id="finalCount">0</strong> voter<span id="finalPlural">s</span> from this drive.
            </p>
            <p id="photoThankYou" style="color: var(--gray-600); font-size: 0.9rem; margin-bottom: 8px; display: none;">
                üì∏ Plus <strong id="photosSentCount">0</strong> photo<span id="photosSentPlural">s</span> ‚Äî thank you!
            </p>
            <p style="color: var(--gray-600); font-size: 0.9rem; margin-bottom: 24px;">
                That is <strong id="finalCount2">0</strong> more vote<span id="finalPlural2">s</span> for sanity, humanity, and democracy. Thank you for this great work ‚Äì keep going! üó≥Ô∏è
            </p>
            <button type="button" class="btn btn-continue" onclick="startNewDrive()">
                üîÑ Restart Drive Score
            </button>
        </div>
    </div>

</div>

<!-- ===== FAQ ===== -->
<div class="faq-btn-wrapper">
    <button class="faq-toggle-btn" onclick="toggleFAQ()">FAQ</button>
</div>

<div class="faq-container" id="faqContainer">
    <div class="faq-header">
        <h2>üéØ Drive Score FAQ</h2>
        <button class="faq-close" onclick="toggleFAQ()">Close FAQ</button>
    </div>

    <div class="faq-item">
        <div class="faq-question">Who built Drive Score?</div>
        <div class="faq-answer">
            Drive Score is a project of <a href="https://www.fieldteam6.org" target="_blank">Field Team 6</a>, a proudly partisan voter registration organization. Our legal designation is a 527 federal PAC working on the IE side.
        </div>
    </div>

    <div class="faq-item">
        <div class="faq-question">Why do you need this info?</div>
        <div class="faq-answer">
            We need this basic info 1) to calculate how many voters Field Team 6 is registering, and 2) so we can find out how many of these new voters <em>actually voted</em> after the next election! You and our thousands of volunteers are doing so much good, but if we can't measure that good so we can tell the world, we can't get more volunteers and donors.<br><br>
            <em>Reporting your Drive Score is literally what keeps Field Team 6 alive and thriving!</em>
        </div>
    </div>

    <div class="faq-item">
        <div class="faq-question">I turned my phone sideways, but something's not working ‚Äì and Drive Score has trouble reading it. Help!</div>
        <div class="faq-answer">
            1. Rotate your phone sideways so that you're shooting in landscape, not portrait mode. (Taking a horizontal shot.) <em>You may have to wait a second for the phone to re-orient.</em><br>
            2. Hold the phone as close to the form as you can while keeping the full name, full address, and date of birth in the frame.<br>
            3. Click the button!
        </div>
    </div>

    <div class="faq-item">
        <div class="faq-question">Are there any privacy risks?</div>
        <div class="faq-answer">
            Drive Score was designed specifically to eliminate privacy risks. That's why the scan is used only to read the text, and is never saved or stored.
        </div>
    </div>

    <div class="faq-item">
        <div class="faq-question">Are my Drive Score results shared with the Democratic Party, any campaign, any list, or any group besides Field Team 6?</div>
        <div class="faq-answer">
            Absolutely not.
        </div>
    </div>

    <div class="faq-item">
        <div class="faq-question">How many voters do I have to register to make a difference?</div>
        <div class="faq-answer">
            Every single voter counts! Major elections have been decided by a single vote. And if you amplify that one voter times a thousand voter drives across the country, that's now 1,000 new voters. Also remember, each voter can vote up and down the ballot, affecting hundreds of races over the course of their lives! <em>You are making a giant difference ‚Äì keep going!!</em>
        </div>
    </div>

    <p style="text-align:center; margin-top: 20px;">
        <strong>Any questions or feedback? Contact us at: <a href="/cdn-cgi/l/email-protection#cfa6a1a9a08f89a6aaa3ab9baaaea2f9e1a0bda8" style="color: var(--blue-bright); text-decoration: none;"><span class="__cf_email__" data-cfemail="4f262129200f09262a232b1b2a2e227961203d28">[email&#160;protected]</span></a></strong>
    </p>
    <p style="text-align:center; margin-top: 10px;">
        <em style="color: var(--blue-bright); font-weight: 600;">Thank you for registering Democrats, and saving the world!</em>
    </p>
</div>

<!-- ===== FOOTER ===== -->
<div class="footer">
    ¬©2026 Drive Score<br>
    Paid for by Field Team 6. <a href="https://www.fieldteam6.org" target="_blank">www.fieldteam6.org</a>.<br>
    Not authorized by any candidate or candidate's committee.
</div>

<!-- ===== JAVASCRIPT ===== -->
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
    // ============================================================
    // üîß CONFIGURATION
    // Paste your Google Apps Script URL below.
    // This SINGLE endpoint handles both OCR extraction and
    // data submission ‚Äî the "action" field tells it what to do.
    // ============================================================
    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwQOTtO__-vM11NtUgJrcqKbmDbZBmuzbs-TcN5HeSxELDaLhs27D9EyBdgknUTfIft/exec";
    const EXTRACT_URL = "/.netlify/functions/extract";

    // Google Drive folder IDs for photo uploads
    const DRIVE_PHOTOS_FOLDER_ID = "1BFu9ssAzlJLLJpGORaCTDBDW5X1ni9d1";
    const SIGNUP_SHEETS_FOLDER_ID = "YOUR_SIGNUP_SHEETS_FOLDER_ID_HERE";
    // ============================================================

    // ---- State ----
    let selectedState = "";
    let voterCount = 0;
    let drivePhotos = [];   // Array of { file, objectURL, base64 }
    let signupPhotos = [];  // Array of { file, objectURL, base64 }
    let totalPhotosSent = 0;

    // ---- Set today's date as default ----
    document.addEventListener("DOMContentLoaded", () => {
        const today = new Date();
        document.getElementById("driveDate").value = today.toISOString().split("T")[0];
        const hh = String(today.getHours()).padStart(2, "0");
        const mm = String(today.getMinutes()).padStart(2, "0");
        document.getElementById("driveTime").value = `${hh}:${mm}`;

        // Populate DOB Day dropdown (1-31)
        const daySelect = document.getElementById("vDOBDay");
        for (let d = 1; d <= 31; d++) {
            const opt = document.createElement("option");
            opt.value = String(d).padStart(2, "0");
            opt.textContent = d;
            daySelect.appendChild(opt);
        }

        // Populate DOB Year dropdown (1920 to current year)
        const yearSelect = document.getElementById("vDOBYear");
        const currentYear = today.getFullYear();
        for (let y = currentYear; y >= 1920; y--) {
            const opt = document.createElement("option");
            opt.value = String(y);
            opt.textContent = y;
            yearSelect.appendChild(opt);
        }
    });

    // Handle scan capture ‚Äî skip preview, go straight to extraction
    async function handleScanCapture(event) {
        const file = event.target.files[0];
        if (!file) return;

        // Hide scan area, show processing immediately
        document.getElementById("scanArea").style.display = "none";
        document.getElementById("processingOverlay").classList.add("active");
        document.querySelector(".processing-subtext").textContent = "This usually takes a few seconds";
        hideError("scanError");

        try {
            // Read EXIF orientation (phones record gyroscope data here)
            const orientation = await getExifOrientation(file);

            // Load image ‚Äî try to get raw pixels without browser EXIF auto-rotation
            const { img, needsManualRotation } = await loadImageForProcessing(file);
            const applyOrientation = needsManualRotation ? orientation : 1;

            // Compress to fit within 5MB base64 API limit
            const MAX_BASE64_CHARS = 5 * 1024 * 1024;
            let base64 = "";
            let passes = 0;

            base64 = resizeAndCompress(img, 1200, 0.90, applyOrientation);

            if (base64.length > MAX_BASE64_CHARS) {
                const steps = [[1200, 0.80], [1000, 0.85], [1000, 0.80]];
                for (const [w, q] of steps) {
                    base64 = resizeAndCompress(img, w, q, applyOrientation);
                    passes++;
                    if (base64.length <= MAX_BASE64_CHARS) break;
                }
            }

            const sizeMB = (base64.length / 1024 / 1024).toFixed(1);
            document.querySelector(".processing-subtext").textContent = `${sizeMB}MB`;

            // Send to Netlify function (direct to Claude API ‚Äî no Apps Script middleman)
            const response = await fetch(EXTRACT_URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    image: base64,
                    state: selectedState
                })
            });

            const text = await response.text();
            let result;
            try {
                result = JSON.parse(text);
            } catch (parseErr) {
                throw new Error("Unexpected response from server. Please try again.");
            }

            if (result.error) {
                throw new Error(result.error);
            }

            populateReviewForm(result);

            document.getElementById("step2").classList.add("hidden");
            document.getElementById("step3").classList.remove("hidden");
            document.getElementById("reviewVoterNum").textContent = voterCount + 1;
            window.scrollTo({ top: 0, behavior: "smooth" });

        } catch (err) {
            showError("scanError", "Scan failed: " + err.message + " ‚Äî You can try again or enter data manually.");
            document.getElementById("scanArea").style.display = "block";
        } finally {
            document.getElementById("processingOverlay").classList.remove("active");
            document.getElementById("scanFile").value = "";
        }
    }

    // ================================================================
    // IMAGE PROCESSING ‚Äî EXIF orientation + resize/compress
    // ================================================================

    // Read EXIF orientation tag from JPEG file (returns 1-8, default 1)
    // Phones record gyroscope orientation here regardless of UI rotation state
    function getExifOrientation(file) {
        return new Promise((resolve) => {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const view = new DataView(e.target.result);
                    if (view.getUint16(0, false) !== 0xFFD8) { resolve(1); return; }
                    let offset = 2;
                    while (offset < view.byteLength - 2) {
                        const marker = view.getUint16(offset, false);
                        offset += 2;
                        if (marker === 0xFFE1) {
                            if (view.getUint32(offset + 2, false) !== 0x45786966) { resolve(1); return; }
                            const tiffStart = offset + 8;
                            const bigEndian = view.getUint16(tiffStart, false) === 0x4D4D;
                            const ifdOffset = view.getUint32(tiffStart + 4, bigEndian);
                            const entries = view.getUint16(tiffStart + ifdOffset, bigEndian);
                            for (let i = 0; i < entries; i++) {
                                const entryOffset = tiffStart + ifdOffset + 2 + i * 12;
                                if (view.getUint16(entryOffset, bigEndian) === 0x0112) {
                                    resolve(view.getUint16(entryOffset + 8, bigEndian));
                                    return;
                                }
                            }
                            resolve(1); return;
                        } else if ((marker & 0xFF00) === 0xFF00) {
                            offset += view.getUint16(offset, false);
                        } else { break; }
                    }
                } catch(e) {}
                resolve(1);
            };
            // Only read first 64KB ‚Äî EXIF is always near the start
            reader.readAsArrayBuffer(file.slice(0, 65536));
        });
    }

    // Load image, trying to get raw pixels WITHOUT browser EXIF auto-rotation
    async function loadImageForProcessing(file) {
        // Try createImageBitmap with imageOrientation:'none' (Chrome 93+, Firefox 98+)
        // This gives raw sensor pixels so we can apply EXIF rotation ourselves
        if (typeof createImageBitmap !== "undefined") {
            try {
                const bitmap = await createImageBitmap(file, { imageOrientation: "none" });
                return { img: bitmap, needsManualRotation: true };
            } catch(e) { /* option not supported (Safari), fall through */ }
        }
        // Fallback: regular Image loading ‚Äî modern browsers auto-apply EXIF
        return { img: await loadImageFromFile(file), needsManualRotation: false };
    }

    // Load image via object URL (browser applies EXIF automatically)
    function loadImageFromFile(file) {
        return new Promise((resolve, reject) => {
            const img = new Image();
            const url = URL.createObjectURL(file);
            img.onload = function() { URL.revokeObjectURL(url); resolve(img); };
            img.onerror = function() { URL.revokeObjectURL(url); reject(new Error("Could not read the scanned image.")); };
            img.src = url;
        });
    }

    // Resize, apply EXIF rotation, and return base64 JPEG
    // orientation: 1=normal, 3=180¬∞, 6=90¬∞CW, 8=90¬∞CCW (others rare)
    function resizeAndCompress(img, maxDim, quality, orientation) {
        const srcW = img.width;
        const srcH = img.height;

        // For 90¬∞/270¬∞ rotations, output dimensions are swapped
        const swap = orientation >= 5 && orientation <= 8;
        let outW = swap ? srcH : srcW;
        let outH = swap ? srcW : srcH;

        // Scale so longest edge fits within maxDim
        const longest = Math.max(outW, outH);
        if (longest > maxDim) {
            const scale = maxDim / longest;
            outW = Math.round(outW * scale);
            outH = Math.round(outH * scale);
        }

        const canvas = document.createElement("canvas");
        canvas.width = outW;
        canvas.height = outH;
        const ctx = canvas.getContext("2d");

        // Apply EXIF orientation transform, then draw scaled image
        switch (orientation) {
            case 2: // Flip horizontal
                ctx.translate(outW, 0);
                ctx.scale(-1, 1);
                ctx.drawImage(img, 0, 0, outW, outH);
                break;
            case 3: // Rotate 180¬∞
                ctx.translate(outW, outH);
                ctx.rotate(Math.PI);
                ctx.drawImage(img, 0, 0, outW, outH);
                break;
            case 4: // Flip vertical
                ctx.translate(0, outH);
                ctx.scale(1, -1);
                ctx.drawImage(img, 0, 0, outW, outH);
                break;
            case 5: // Rotate 90¬∞CW + flip horizontal
                ctx.translate(outW, 0);
                ctx.rotate(Math.PI / 2);
                ctx.scale(-1, 1);
                ctx.drawImage(img, 0, 0, outH, outW);
                break;
            case 6: // Rotate 90¬∞CW
                ctx.translate(outW, 0);
                ctx.rotate(Math.PI / 2);
                ctx.drawImage(img, 0, 0, outH, outW);
                break;
            case 7: // Rotate 90¬∞CCW + flip horizontal
                ctx.translate(0, outH);
                ctx.rotate(-Math.PI / 2);
                ctx.scale(-1, 1);
                ctx.drawImage(img, 0, 0, outH, outW);
                break;
            case 8: // Rotate 90¬∞CCW
                ctx.translate(0, outH);
                ctx.rotate(-Math.PI / 2);
                ctx.drawImage(img, 0, 0, outH, outW);
                break;
            default: // 1 = normal, no rotation
                ctx.drawImage(img, 0, 0, outW, outH);
        }

        return canvas.toDataURL("image/jpeg", quality).split(",")[1];
    }

    // ================================================================
    // STEP 1 ‚Üí STEP 2:  Drive Info ‚Üí Scan
    // ================================================================
    function continueToScan() {
        const first = document.getElementById("leaderFirst").value.trim();
        const last = document.getElementById("leaderLast").value.trim();
        const date = document.getElementById("driveDate").value;
        const time = document.getElementById("driveTime").value;
        const city = document.getElementById("driveCity").value.trim();
        const state = document.getElementById("driveState").value;

        if (!first || !last || !date || !time || !city || !state) {
            showError("step1Error", "Please fill in all drive info fields.");
            return;
        }
        hideError("step1Error");
        selectedState = state;

        // Populate summary
        const summary = `${first} ${last} ¬∑ ${formatDate(date)} at ${formatTime(time)} ¬∑ ${city}, ${state}`;
        document.getElementById("summaryText").textContent = summary;
        document.getElementById("summaryText2").textContent = summary;

        // Configure DOB fields for review step based on state
        configureDOBFields();

        // Set scan guidance based on state
        const importantPrefix = '<span style="color: var(--red-soft); font-weight: 800;">IMPORTANT:</span> ';
        let scanTip = importantPrefix + "Turn the phone horizontal (landscape) and get as close to the form as you can, while keeping name, address and date of birth visible.";
        if (state === "Georgia" || state === "Colorado") {
            scanTip = importantPrefix + "Turn the phone horizontal (landscape) and get as close to the form as you can, while keeping name, address and year of birth visible.";
        } else if (state === "North Carolina") {
            scanTip = importantPrefix + "Turn the phone horizontal (landscape) and get as close to the form as you can, while keeping name and address visible.";
        }
        document.getElementById("scanHint").innerHTML = scanTip;

        // Show scan step
        document.getElementById("step1").classList.add("hidden");
        document.getElementById("step2").classList.remove("hidden");
        window.scrollTo({ top: 0, behavior: "smooth" });
    }

    function editDriveInfo() {
        resetScanStep();
        document.getElementById("step2").classList.add("hidden");
        document.getElementById("step1").classList.remove("hidden");
        window.scrollTo({ top: 0, behavior: "smooth" });
    }

    function configureDOBFields() {
        const dobField = document.getElementById("dobField");
        const yobField = document.getElementById("yobField");

        if (selectedState === "Georgia" || selectedState === "Colorado") {
            dobField.classList.add("hidden");
            yobField.classList.remove("hidden");
        } else if (selectedState === "North Carolina") {
            dobField.classList.add("hidden");
            yobField.classList.add("hidden");
        } else {
            dobField.classList.remove("hidden");
            yobField.classList.add("hidden");
        }
    }

    // ================================================================
    // STEP 3:  Review form population
    // ================================================================

    function populateReviewForm(data) {
        document.getElementById("vFirstName").value = data.firstName || "";
        document.getElementById("vMiddleName").value = data.middleName || "";
        document.getElementById("vLastName").value = data.lastName || "";
        document.getElementById("vSuffix").value = data.suffix || "";
        document.getElementById("vStreet").value = data.street || "";
        document.getElementById("vApt").value = data.apt || "";
        document.getElementById("vCity").value = data.city || "";
        document.getElementById("vState").value = selectedState;
        document.getElementById("vZip").value = data.zip || "";

        // Handle DOB based on state
        if (selectedState === "Georgia" || selectedState === "Colorado") {
            document.getElementById("vYOB").value = data.yearOfBirth || "";
        } else if (selectedState !== "North Carolina") {
            // Standard DOB ‚Äî parse and set the 3 dropdowns
            if (data.dob) {
                const parsed = parseDOB(data.dob);
                if (parsed) {
                    const [year, month, day] = parsed.split("-");
                    document.getElementById("vDOBMonth").value = month;
                    document.getElementById("vDOBDay").value = day;
                    document.getElementById("vDOBYear").value = year;
                }
            }
        }

        // Show confidence indicator
        updateConfidence(data.confidence || "medium");
    }

    function parseDOB(dobString) {
        // Attempt to parse various DOB formats into YYYY-MM-DD
        if (!dobString) return "";

        // Already in YYYY-MM-DD format
        if (/^\d{4}-\d{2}-\d{2}$/.test(dobString)) return dobString;

        // MM/DD/YYYY or MM-DD-YYYY
        const match = dobString.match(/^(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{4})$/);
        if (match) {
            const mm = match[1].padStart(2, "0");
            const dd = match[2].padStart(2, "0");
            return `${match[3]}-${mm}-${dd}`;
        }

        // Try built-in Date parsing as fallback
        const d = new Date(dobString);
        if (!isNaN(d.getTime())) {
            return d.toISOString().split("T")[0];
        }

        return "";
    }

    function updateConfidence(level) {
        const bar = document.getElementById("confidenceIndicator");
        const icon = document.getElementById("confidenceIcon");
        const text = document.getElementById("confidenceText");

        bar.className = "confidence-bar";

        if (level === "high") {
            bar.classList.add("confidence-high");
            icon.textContent = "‚úÖ";
            text.innerHTML = 'High confidence ‚Äì <span style="color: var(--red-soft); font-weight: 700;">but always check all fields to correct errors</span>';
        } else if (level === "medium") {
            bar.classList.add("confidence-medium");
            icon.textContent = "‚ö†Ô∏è";
            text.innerHTML = 'Medium confidence ‚Äì <span style="color: var(--red-soft); font-weight: 700;">always check all fields to correct errors</span>';
        } else {
            bar.classList.add("confidence-low");
            icon.textContent = "üîç";
            text.innerHTML = 'Low confidence ‚Äì <span style="color: var(--red-soft); font-weight: 700;">check all fields to correct errors</span>';
        }
    }

    // ================================================================
    // STEP 3:  Submit voter and go back to scan (or finish)
    // ================================================================
    async function submitVoter() {
        // Validate required fields
        const firstName = document.getElementById("vFirstName").value.trim();
        const lastName = document.getElementById("vLastName").value.trim();
        const street = document.getElementById("vStreet").value.trim();
        const city = document.getElementById("vCity").value.trim();
        const zip = document.getElementById("vZip").value.trim();

        if (!firstName || !lastName || !street || !city || !zip) {
            showError("reviewError", "Please fill in all required fields.");
            return false;
        }

        // Validate state-specific DOB
        if (selectedState === "Georgia" || selectedState === "Colorado") {
            const yob = document.getElementById("vYOB").value.trim();
            if (!yob || !/^\d{4}$/.test(yob)) {
                showError("reviewError", "Please enter a valid 4-digit year of birth.");
                return false;
            }
        } else if (selectedState !== "North Carolina") {
            const dobMonth = document.getElementById("vDOBMonth").value;
            const dobDay = document.getElementById("vDOBDay").value;
            const dobYear = document.getElementById("vDOBYear").value;
            if (!dobMonth || !dobDay || !dobYear) {
                showError("reviewError", "Please select the full date of birth.");
                return false;
            }
        }

        hideError("reviewError");

        // Build voter data
        const voterData = {
            firstName: firstName,
            middleName: document.getElementById("vMiddleName").value.trim(),
            lastName: lastName,
            suffix: document.getElementById("vSuffix").value.trim(),
            street: street,
            apt: document.getElementById("vApt").value.trim(),
            city: city,
            state: selectedState,
            zip: zip,
            dob: "",
            gaYOB: ""
        };

        if (selectedState === "Georgia" || selectedState === "Colorado") {
            voterData.gaYOB = document.getElementById("vYOB").value.trim();
        } else if (selectedState !== "North Carolina") {
            const m = document.getElementById("vDOBMonth").value;
            const d = document.getElementById("vDOBDay").value;
            const y = document.getElementById("vDOBYear").value;
            if (m && d && y) {
                voterData.dob = `${m}/${d}/${y}`;
            }
        }

        // Build drive info
        const driveInfo = {
            leaderFirst: document.getElementById("leaderFirst").value.trim(),
            leaderLast: document.getElementById("leaderLast").value.trim(),
            driveDate: document.getElementById("driveDate").value,
            driveTime: document.getElementById("driveTime").value,
            city: document.getElementById("driveCity").value.trim(),
            state: selectedState
        };

        // Disable buttons
        document.getElementById("submitVoterBtn").disabled = true;

        try {
            const response = await fetch(GOOGLE_SCRIPT_URL, {
                method: "POST",
                redirect: "follow",
                headers: { "Content-Type": "text/plain" },
                body: JSON.stringify({
                    action: "submit",
                    driveInfo: driveInfo,
                    voters: [voterData]
                })
            });

            const text = await response.text();
            let result;
            try {
                result = JSON.parse(text);
            } catch (parseErr) {
                throw new Error("Unexpected response from server.");
            }

            if (result.error) {
                throw new Error(result.error);
            }

            voterCount++;
            document.getElementById("voterCountNum").textContent = voterCount;
            return true;

        } catch (err) {
            showError("reviewError", "Submission failed: " + err.message);
            return false;

        } finally {
            document.getElementById("submitVoterBtn").disabled = false;
        }
    }

    async function submitVoterAndNext() {
        const success = await submitVoter();
        if (success) {
            resetScanStep();
            document.getElementById("step3").classList.add("hidden");
            document.getElementById("step2").classList.remove("hidden");
            window.scrollTo({ top: 0, behavior: "smooth" });
        }
    }

    async function submitVoterAndFinish() {
        const success = await submitVoter();
        if (success) {
            showCompletionScreen();
        }
    }

    function finishDrive() {
        if (voterCount === 0) {
            if (!confirm("You haven't submitted any voters yet. Are you sure you want to finish?")) return;
        }
        showCompletionScreen();
    }

    function showCompletionScreen() {
        document.getElementById("step2").classList.add("hidden");
        document.getElementById("step3").classList.add("hidden");
        // Go to photo upload step instead of final screen
        showPhotoUploadStep();
    }

    function showPhotoUploadStep() {
        // Reset photo state
        drivePhotos = [];
        signupPhotos = [];
        totalPhotosSent = 0;
        document.getElementById("drivePhotoThumbs").innerHTML = "";
        document.getElementById("signupPhotoThumbs").innerHTML = "";
        document.getElementById("drivePhotoCount").textContent = "";
        document.getElementById("signupPhotoCount").textContent = "";
        document.getElementById("sendPhotosBtn").disabled = false;
        document.getElementById("uploadProgress").classList.remove("active");
        hideError("photoUploadError");
        updateSendButtonState();

        document.getElementById("step4").classList.remove("hidden");
        window.scrollTo({ top: 0, behavior: "smooth" });
    }

    function showFinalScreen() {
        document.getElementById("step4").classList.add("hidden");
        document.getElementById("step5").classList.remove("hidden");
        document.getElementById("finalCount").textContent = voterCount;
        document.getElementById("finalPlural").textContent = voterCount === 1 ? "" : "s";
        document.getElementById("finalCount2").textContent = voterCount;
        document.getElementById("finalPlural2").textContent = voterCount === 1 ? "" : "s";

        // Show photo count if any were sent
        if (totalPhotosSent > 0) {
            document.getElementById("photoThankYou").style.display = "block";
            document.getElementById("photosSentCount").textContent = totalPhotosSent;
            document.getElementById("photosSentPlural").textContent = totalPhotosSent === 1 ? "" : "s";
        } else {
            document.getElementById("photoThankYou").style.display = "none";
        }

        window.scrollTo({ top: 0, behavior: "smooth" });
        launchConfetti();
    }

    function launchConfetti() {
        const container = document.createElement("div");
        container.className = "confetti-container";
        document.body.appendChild(container);

        const colors = [
            "#f5c542", // FT6 gold
            "#3a7bd5", // FT6 blue
            "#5b9ef0", // light blue
            "#27ae60", // green
            "#e74c3c", // red
            "#ffffff", // white
            "#2b4c7e", // dark blue
            "#f39c12", // orange
        ];

        const pieceCount = 80;

        for (let i = 0; i < pieceCount; i++) {
            const piece = document.createElement("div");
            piece.className = "confetti-piece";

            const color = colors[Math.floor(Math.random() * colors.length)];
            const left = Math.random() * 100;
            const duration = 2.5 + Math.random() * 2;
            const delay = Math.random() * 1.5;
            const size = 6 + Math.random() * 8;
            const shape = Math.random();

            piece.style.left = left + "%";
            piece.style.width = size + "px";
            piece.style.height = (size * (1 + Math.random())) + "px";
            piece.style.background = color;
            piece.style.animationDuration = duration + "s";
            piece.style.animationDelay = delay + "s";

            // Mix of rectangles, squares, and circles
            if (shape < 0.33) {
                piece.style.borderRadius = "50%";
            } else if (shape < 0.66) {
                piece.style.borderRadius = "2px";
            } else {
                piece.style.height = size + "px";
                piece.style.borderRadius = "1px";
            }

            container.appendChild(piece);
        }

        // Clean up after animation completes
        setTimeout(() => container.remove(), 5500);
    }

    // ================================================================
    // PHOTO UPLOAD FUNCTIONS
    // ================================================================

    function handlePhotoSelect(event, type) {
        const files = Array.from(event.target.files);
        if (!files.length) return;

        const photoArray = type === "drive" ? drivePhotos : signupPhotos;
        const thumbsContainer = document.getElementById(type === "drive" ? "drivePhotoThumbs" : "signupPhotoThumbs");
        const countEl = document.getElementById(type === "drive" ? "drivePhotoCount" : "signupPhotoCount");

        files.forEach(file => {
            const objectURL = URL.createObjectURL(file);
            const index = photoArray.length;
            photoArray.push({ file, objectURL, base64: null });

            // Create thumbnail
            const wrapper = document.createElement("div");
            wrapper.className = "photo-thumb-wrapper";
            wrapper.id = `thumb_${type}_${index}`;

            const img = document.createElement("img");
            img.src = objectURL;

            const removeBtn = document.createElement("button");
            removeBtn.className = "photo-thumb-remove";
            removeBtn.textContent = "‚úï";
            removeBtn.onclick = () => removePhoto(type, index);

            wrapper.appendChild(img);
            wrapper.appendChild(removeBtn);
            thumbsContainer.appendChild(wrapper);
        });

        // Update count
        const activeCount = photoArray.filter(p => p !== null).length;
        countEl.textContent = activeCount > 0 ? `${activeCount} photo${activeCount === 1 ? "" : "s"} selected` : "";

        // Clear file input so same file can be re-selected
        event.target.value = "";

        updateSendButtonState();
    }

    function removePhoto(type, index) {
        const photoArray = type === "drive" ? drivePhotos : signupPhotos;
        if (photoArray[index]) {
            URL.revokeObjectURL(photoArray[index].objectURL);
            photoArray[index] = null; // null out, don't splice (preserves indices)
        }

        const thumbEl = document.getElementById(`thumb_${type}_${index}`);
        if (thumbEl) thumbEl.remove();

        const countEl = document.getElementById(type === "drive" ? "drivePhotoCount" : "signupPhotoCount");
        const activeCount = photoArray.filter(p => p !== null).length;
        countEl.textContent = activeCount > 0 ? `${activeCount} photo${activeCount === 1 ? "" : "s"} selected` : "";

        updateSendButtonState();
    }

    function updateSendButtonState() {
        const driveCount = drivePhotos.filter(p => p !== null).length;
        const signupCount = signupPhotos.filter(p => p !== null).length;
        const total = driveCount + signupCount;
        const btn = document.getElementById("sendPhotosBtn");
        btn.disabled = total === 0;
        btn.textContent = total > 0 ? `üì§ Send ${total} Photo${total === 1 ? "" : "s"} to Field Team 6` : "üì§ Send to Field Team 6";
    }

    // Build filename per convention: {City}_{State} {MM}_{DD}_{YY} {First} {Last} {#}.jpg
    function buildPhotoFilename(type, photoNumber) {
        const city = document.getElementById("driveCity").value.trim();
        const state = selectedState;
        const dateStr = document.getElementById("driveDate").value;
        const first = document.getElementById("leaderFirst").value.trim();
        const last = document.getElementById("leaderLast").value.trim();

        // Parse date
        const [yearFull, month, day] = dateStr.split("-");
        const yearShort = yearFull.slice(2); // "2026" ‚Üí "26"
        const m = parseInt(month);
        const d = parseInt(day);

        // Build state abbreviation from full name
        const stateAbbrevs = {
            "Alabama":"AL","Alaska":"AK","Arizona":"AZ","Arkansas":"AR","California":"CA",
            "Colorado":"CO","Connecticut":"CT","Delaware":"DE","Florida":"FL","Georgia":"GA",
            "Hawaii":"HI","Idaho":"ID","Illinois":"IL","Indiana":"IN","Iowa":"IA","Kansas":"KS",
            "Kentucky":"KY","Louisiana":"LA","Maine":"ME","Maryland":"MD","Massachusetts":"MA",
            "Michigan":"MI","Minnesota":"MN","Mississippi":"MS","Missouri":"MO","Montana":"MT",
            "Nebraska":"NE","Nevada":"NV","New Hampshire":"NH","New Jersey":"NJ","New Mexico":"NM",
            "New York":"NY","North Carolina":"NC","North Dakota":"ND","Ohio":"OH","Oklahoma":"OK",
            "Oregon":"OR","Pennsylvania":"PA","Rhode Island":"RI","South Carolina":"SC",
            "South Dakota":"SD","Tennessee":"TN","Texas":"TX","Utah":"UT","Vermont":"VT",
            "Virginia":"VA","Washington":"WA","West Virginia":"WV","Wisconsin":"WI","Wyoming":"WY",
            "Washington D.C.":"DC"
        };
        const stateAbbr = stateAbbrevs[state] || state;

        const prefix = type === "signup" ? "Signup_" : "";
        const numSuffix = photoNumber > 1 ? ` ${photoNumber}` : "";
        return `${prefix}${city}_${stateAbbr} ${m}_${d}_${yearShort} ${first} ${last}${numSuffix}.jpg`;
    }

    // Compress a photo file to base64 JPEG (reuses existing EXIF/resize logic)
    async function compressPhotoForUpload(file) {
        const orientation = await getExifOrientation(file);
        const { img, needsManualRotation } = await loadImageForProcessing(file);
        const applyOrientation = needsManualRotation ? orientation : 1;

        // Compress to max 1600px, quality 0.85 ‚Äî good balance of quality vs size
        return resizeAndCompress(img, 1600, 0.85, applyOrientation);
    }

    async function sendPhotos() {
        const activeDrivePhotos = drivePhotos.filter(p => p !== null);
        const activeSignupPhotos = signupPhotos.filter(p => p !== null);
        const total = activeDrivePhotos.length + activeSignupPhotos.length;

        if (total === 0) {
            skipPhotos();
            return;
        }

        // Disable buttons
        document.getElementById("sendPhotosBtn").disabled = true;
        document.querySelector(".btn-skip-photos").style.display = "none";
        hideError("photoUploadError");

        // Show progress
        const progressEl = document.getElementById("uploadProgress");
        const progressBar = document.getElementById("uploadProgressBar");
        const progressText = document.getElementById("uploadProgressText");
        progressEl.classList.add("active");

        let uploaded = 0;
        let failed = 0;

        try {
            // Upload drive photos
            let driveNum = 0;
            for (const photo of activeDrivePhotos) {
                driveNum++;
                progressText.textContent = `Uploading drive photo ${driveNum} of ${activeDrivePhotos.length}...`;
                progressBar.style.width = `${(uploaded / total) * 100}%`;

                try {
                    const base64 = await compressPhotoForUpload(photo.file);
                    const filename = buildPhotoFilename("drive", driveNum);

                    await fetch(GOOGLE_SCRIPT_URL, {
                        method: "POST",
                        redirect: "follow",
                        headers: { "Content-Type": "text/plain" },
                        body: JSON.stringify({
                            action: "uploadPhoto",
                            folderId: DRIVE_PHOTOS_FOLDER_ID,
                            filename: filename,
                            base64: base64
                        })
                    });
                    uploaded++;
                } catch (err) {
                    console.error("Drive photo upload failed:", err);
                    failed++;
                    uploaded++;
                }
            }

            // Upload signup photos
            let signupNum = 0;
            for (const photo of activeSignupPhotos) {
                signupNum++;
                progressText.textContent = `Uploading sign-up sheet ${signupNum} of ${activeSignupPhotos.length}...`;
                progressBar.style.width = `${(uploaded / total) * 100}%`;

                try {
                    const base64 = await compressPhotoForUpload(photo.file);
                    const filename = buildPhotoFilename("signup", signupNum);

                    await fetch(GOOGLE_SCRIPT_URL, {
                        method: "POST",
                        redirect: "follow",
                        headers: { "Content-Type": "text/plain" },
                        body: JSON.stringify({
                            action: "uploadPhoto",
                            folderId: SIGNUP_SHEETS_FOLDER_ID,
                            filename: filename,
                            base64: base64
                        })
                    });
                    uploaded++;
                } catch (err) {
                    console.error("Signup photo upload failed:", err);
                    failed++;
                    uploaded++;
                }
            }

            progressBar.style.width = "100%";

            if (failed > 0) {
                progressText.textContent = `Done! ${total - failed} of ${total} uploaded (${failed} failed).`;
            } else {
                progressText.textContent = `All ${total} photo${total === 1 ? "" : "s"} uploaded!`;
            }

            totalPhotosSent = total - failed;

            // Brief pause to show completion, then move on
            await new Promise(r => setTimeout(r, 1200));

            // Clean up object URLs
            drivePhotos.forEach(p => { if (p) URL.revokeObjectURL(p.objectURL); });
            signupPhotos.forEach(p => { if (p) URL.revokeObjectURL(p.objectURL); });

            showFinalScreen();

        } catch (err) {
            showError("photoUploadError", "Upload failed: " + err.message + ". You can try again.");
            document.getElementById("sendPhotosBtn").disabled = false;
            document.querySelector(".btn-skip-photos").style.display = "";
            progressEl.classList.remove("active");
        }
    }

    function skipPhotos() {
        totalPhotosSent = 0;
        // Clean up object URLs
        drivePhotos.forEach(p => { if (p) URL.revokeObjectURL(p.objectURL); });
        signupPhotos.forEach(p => { if (p) URL.revokeObjectURL(p.objectURL); });
        showFinalScreen();
    }

    // ================================================================
    // RESET & UTILITIES
    // ================================================================
    // Go back to scan step to re-scan the same form
    function rescanForm() {
        resetScanStep();
        document.getElementById("step3").classList.add("hidden");
        document.getElementById("step2").classList.remove("hidden");
        window.scrollTo({ top: 0, behavior: "smooth" });
    }

    function resetScanStep() {
        document.getElementById("scanFile").value = "";
        document.getElementById("scanArea").style.display = "block";
        document.getElementById("processingOverlay").classList.remove("active");
        hideError("scanError");

        // Clear review form
        document.getElementById("vFirstName").value = "";
        document.getElementById("vMiddleName").value = "";
        document.getElementById("vLastName").value = "";
        document.getElementById("vSuffix").value = "";
        document.getElementById("vStreet").value = "";
        document.getElementById("vApt").value = "";
        document.getElementById("vCity").value = "";
        document.getElementById("vZip").value = "";
        document.getElementById("vDOBMonth").value = "";
        document.getElementById("vDOBDay").value = "";
        document.getElementById("vDOBYear").value = "";
        document.getElementById("vYOB").value = "";
        hideError("reviewError");
    }

    function startNewDrive() {
        // Full reset
        voterCount = 0;
        selectedState = "";
        drivePhotos = [];
        signupPhotos = [];
        totalPhotosSent = 0;
        resetScanStep();

        document.getElementById("leaderFirst").value = "";
        document.getElementById("leaderLast").value = "";
        document.getElementById("driveCity").value = "";
        document.getElementById("driveState").value = "";

        // Reset date/time to now
        const today = new Date();
        document.getElementById("driveDate").value = today.toISOString().split("T")[0];
        const hh = String(today.getHours()).padStart(2, "0");
        const mm = String(today.getMinutes()).padStart(2, "0");
        document.getElementById("driveTime").value = `${hh}:${mm}`;

        document.getElementById("voterCountNum").textContent = "0";

        document.getElementById("step4").classList.add("hidden");
        document.getElementById("step5").classList.add("hidden");
        document.getElementById("step1").classList.remove("hidden");
        window.scrollTo({ top: 0, behavior: "smooth" });
    }

    // ---- Error handling ----
    function showError(id, msg) {
        const el = document.getElementById(id);
        el.textContent = msg;
        el.className = "status error";
    }
    function hideError(id) {
        const el = document.getElementById(id);
        el.style.display = "none";
        el.className = "status";
        el.textContent = "";
        // Re-enable display:none via class removal
        setTimeout(() => { el.style.display = ""; }, 10);
    }

    // ---- Formatting helpers ----
    function formatDate(dateStr) {
        const [y, m, d] = dateStr.split("-");
        return `${parseInt(m)}/${parseInt(d)}/${y}`;
    }
    function formatTime(timeStr) {
        let [h, m] = timeStr.split(":");
        h = parseInt(h);
        const ampm = h >= 12 ? "PM" : "AM";
        if (h > 12) h -= 12;
        if (h === 0) h = 12;
        return `${h}:${m} ${ampm}`;
    }
    // ---- FAQ toggle ----
    function toggleFAQ() {
        const faqContainer = document.getElementById('faqContainer');
        if (faqContainer) {
            faqContainer.classList.toggle('show');
            if (faqContainer.classList.contains('show')) {
                faqContainer.scrollIntoView({ behavior: 'smooth' });
            }
        }
    }
</script>
</body>
</html>
